# Task 1 DevOps 1.0

## DO #1 - Bash Scripting

First you need to clone the following repo to you host machine with the next command:
```
git clone git@github.com:serhieiev/devops_intern_serhieiev.git
```

Once the repository is cloned, change your directory to the root folder of the project.

To build the `Docker`` image. Use the following command to build the image:
```
docker build -t repo_backup_image .
```

Don't forget t build the new image with `-no-cache` flag if `backup.sh` has been modified:
```
docker build --no-cache -t repo_backup_image .
```

Once the `Docker` image has been built successfully, you can run the container using the command below. This command mounts a local directory backups to the container, which will store the backup files. Additionally, it mounts your specific GitHub private key to the container. Ensure that the path to your private key (`~/.ssh/id_rsa` in the example) is correct. If you use a different key for GitHub or if it's located elsewhere, replace `~/.ssh/id_rsa` with the appropriate path.

```
docker run -v $(pwd)/backups:/backups -v ~/.ssh/id_rsa:/root/.ssh/id_rsa repo_backup_image
```

Also adding the `-e MAX_BACKUPS=some_int` environment variable determines the maximum number of backup versions to keep. If the number of backups exceeds this value, the oldest backups will be deleted until the count matches the specified maximum. Passong `-e MAX_BACKUPS=0` deletes all backups.

Example of a command can look like (keep 5 latest backups):
```
docker run -v $(pwd)/backups:/backups -v ~/.ssh/id_rsa:/root/.ssh/id_rsa -e MAX_BACKUPS=5 repo_backup_image
```

After executing the above command, you should see a folder named `backups` in your current directory. Inside this folder, you'll find the backup files, which are the result of executing the `backup.sh` script inside the Docker container.


## DO #2 - Docker/Docker Compose

Make sure that the following repo is cloned to you host machine :
```
git clone git@github.com:serhieiev/devops_intern_serhieiev.git
```

Change your directory to the root folder of the project.

Copy the sample of environment configuration file:
```
cp .env.sample .env
```

Adjust the `.env` file and update variables according your setup.

Build and start the `Docker` containers with `docker-compose`:
```
docker-compose up --build
```

Navigate to the following link in your browser:
``` 
http://localhost
```

You should see helth-check like:
```
Status: 200
Date: 9/23/23, 5:54 PM
Message: I'm alive
```

To stop containers:
```
docker-compose down
```

## DO #4-2 AWS Console

### AddÂ an IAM user with read-only permissions to all of the services

- Sign in to the AWS Management Console.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/8defc7e5-e2b2-4a9d-8642-7c9af35490b9)
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/b25a595b-d7c8-4d99-b6e5-f35fe436ac7e)

- Using search type `iam` and select `Groups` to open the IAM console.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/18a46297-dae2-4917-ae8b-4d91a25af3ea)

- Create a new User group by clicking the `Create group` CTA.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/f9ce6c81-fb42-42fc-872c-da6d945e17fd)

- Give new group a name. 
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/0896390c-c7fb-444c-ad69-903d7ed6a825)

- After that attach `ReadOnlyAccess` permissions policies and click the `Create group` CTA.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/4e594501-0560-4dfa-adfa-f7b363027eea)

- Make sure your newly created group is listed under the `User groups` list.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/d8a6e4e9-d51c-459d-b46b-ab5c33d64f8e)

- From the left-side menu go to the `Users` and click the `Crete user` CTA.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/6a72a6a6-706c-488a-99e8-191b5c586021)

- Next specify `User name`, select `Provide user access to the AWS Management Console` option, select `I want to create an IAM user` radio-option, `Autogenerated password` radio-option, unselect `Users must create a new password at next sign-in - Recommended` just to make Seva's life easier, and finaly click `Next` btn.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/0b7c0462-c490-4bdd-af12-72f25c3d9d42)

- After that, add user to the `ReadOnlyGroup` created before, and click `Next` btn.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/5660620a-563c-4a32-be01-e2302f665a0c)

- Review and click the `Create user` btn.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/1e3ca8b8-f3b1-47fc-8c52-20663f35c292)

- After that, email a newly created user with thei credentials.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/f7f09570-294b-49b8-abec-b211fdce4174)

### Create a Virtual Machine (EC2) with elastic IP, a private ECR registry, and separate service roles required to access the registry and EC2

- Navigate to EC2 in the AWS Management Console.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/81a8b4ef-613d-4a8a-9678-364af99c4993)

- Click `Launch Instance` CTA.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/052f1ddf-a851-4a46-abc5-ee4cf09800bf)

- Name instance, choose an AMI (Ubuntu 22.04 in my case), instance type - `t2.micro`.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/4465ee17-657f-4252-8435-96f6ec770ef4)

- Create a new key-pair.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/446d9c23-abf2-4f07-a80a-1f63d5999185)

- For the `Network settings`, select `Create security group` radio-option, and `Allow SSH traffic from` `for My IP` for the security matters (it can be adjusted latter). To launch the instance click `Launch Instance` btn.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/a00a9479-8d8b-49b2-804d-88fe523144dc)

- In the EC2 Dashboard, under `Network & Security`, choose `Elastic IPs`.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/314e2b9d-03ce-4230-a137-78fa0ead2197)

- Click `Allocate` and associate it with the instance you just created.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/3d54123b-ae8b-448c-b986-7d85ee24ff1f)
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/d3735647-ce44-4d4f-a696-ce72a976f81b)
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/110ba4cf-53a5-4d26-94c9-39e7e3258494)

- Navigate to `Elastic Container Registry` (ECR) and create `Private` repository.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/61cb7aee-dac5-4548-b862-a14b04ec3eae)

- Create new policy for the `ECR` from the IAM (Identity and Access Management) service.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/356b2bca-3e92-453e-a21e-23bd1851a295)

- Add the following actions: `GetAuthorizationToken`, `BatchCheckLayerAvailability`, `PutImage`, `InitiateLayerUpload`, `UploadLayerPart`, `CompleteLayerUpload` when creating new policy.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/5810c1b0-1983-44b0-8110-39b1f4b34334)

- Specify the `Policy name` and click the `Create policy` btn.
![image](https://github.com/serhieiev/devops_intern_serhieiev/assets/12089303/a774a57b-fa39-46aa-8a53-e67df0226a70)

- Create IAM Policy for S3 operations, and it should contain the following actions: `PutObject`, `GetObject`, `ListBucket`

